// Generated by CoffeeScript 1.10.0
var ciudades, contacto, fullpage, refreshCaptcha;

$(window).on('load resize', function() {
  $.fn.fullpage.destroy('all');
  return fullpage();
});

$(function() {
  var controller;
  fullpage();
  contacto();
  $("#contacto form .estado").change(function() {
    var region;
    region = $('option:selected', $(this)).val();
    return ciudades.load(region, "#contacto_ciudad");
  });
  controller = $.superscrollorama({
    triggerAtCenter: false,
    playoutAnimations: true
  });
  controller.addTween('#historia', (new TimelineLite).append([
    TweenMax.fromTo($('#nosotros_box'), 1, {
      css: {
        top: -100
      },
      immediateRender: true
    }, {
      css: {
        top: -400
      }
    }), TweenMax.fromTo($('#nosotros_pic'), 2, {
      css: {
        top: 0
      },
      immediateRender: true
    }, {
      css: {
        top: 0
      }
    })
  ]), 1000);
  controller.addTween('#equipos', (new TimelineLite).append([
    TweenMax.fromTo($('#equipos_portada_box'), 1, {
      css: {
        top: -100
      },
      immediateRender: true
    }, {
      css: {
        top: -400
      }
    }), TweenMax.fromTo($('#equipos_portada_pic'), 1, {
      css: {
        top: 300
      },
      immediateRender: true
    }, {
      css: {
        top: -400
      }
    })
  ]), 1000);
  controller.addTween('#utensilios', (new TimelineLite).append([
    TweenMax.fromTo($('#utensilios_box'), 1, {
      css: {
        top: -100
      },
      immediateRender: true
    }, {
      css: {
        top: -400
      }
    }), TweenMax.fromTo($('#utensilios_pic'), 1, {
      css: {
        top: 0
      },
      immediateRender: true
    }, {
      css: {
        top: -0
      }
    })
  ]), 1000);
  controller.addTween('#loza', (new TimelineLite).append([
    TweenMax.fromTo($('#loza_box'), 1, {
      css: {
        top: 0
      },
      immediateRender: true
    }, {
      css: {
        top: -0
      }
    }), TweenMax.fromTo($('#loza_pic'), 1, {
      css: {
        top: 0
      },
      immediateRender: true
    }, {
      css: {
        top: -0
      }
    })
  ]), 1000);
  return $('#map').click(function() {
    return $(this).find('iframe').addClass('clicked');
  }).mouseleave(function() {
    return $(this).find('iframe').removeClass('clicked');
  });
});

$(window).load(function() {
  return $('.phone').mask('(000) 000 0000');
});

ciudades = {
  load: function(region, target) {
    return $.ajax({
      type: "POST",
      url: base + "ajax/geo/cities",
      data: {
        country: 134,
        region: region
      },
      success: function(response) {
        var $output;
        $output = '';
        response.forEach(function(value, index) {
          console.log(value);
          return $output += '<option value="' + value.rel + '">' + value.name + '</option>';
        });
        return $(target).html($output).removeAttr('disabled');
      },
      complete: function() {
        return $("#contacto_ciudad").material_select('update');
      }
    });
  }
};

contacto = function() {
  return $("#contacto form").submit(function(e) {
    var $button, $init, $this;
    e.preventDefault();
    $this = $(this);
    $button = $("#contacto form button[type='submit']");
    $init = $button.html();
    $button.html("Procesando...").attr('disabeld');
    return $.ajax({
      type: $this.attr('method'),
      url: $this.attr('action'),
      data: $this.serialize(),
      dataType: "json",
      success: function(res) {
        switch (parseInt(res.status)) {
          case 1:
            Materialize.toast(res.data, 10000);
            refreshCaptcha();
            $("#contacto_ciudad").html("");
            $this[0].reset();
            return $("#contacto_ciudad").attr('disabled');
          case 0:
            Materialize.toast(res.data, 10000);
            return refreshCaptcha();
        }
      },
      complete: function() {
        return $button.html($init).removeAttr('disabled');
      }
    });
  });
};

refreshCaptcha = function() {
  return $.ajax({
    type: "POST",
    url: base + "ajax/refresh-captcha.php",
    cache: false,
    async: false,
    data: {
      action: 'refresh_captcha'
    },
    dataType: "html",
    success: function(data) {
      return $('.cap').html(data);
    }
  });
};

fullpage = function() {
  return $('#fullpage').fullpage({
    loopBottom: false,
    autoScrolling: true,
    fitToSection: false,
    scrollBar: true,
    offsetSections: true,
    scrollOverflowReset: true,
    scrollOverflow: false,
    verticalCentered: false,
    fixedElements: '#header'
  });
};
